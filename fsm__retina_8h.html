<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Retina: recepción y transmisión de infrarrojos: common/include/fsm_retina.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Retina: recepción y transmisión de infrarrojos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('fsm__retina_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fsm_retina.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header for <a class="el" href="fsm__retina_8c.html" title="Retina FSM main file.">fsm_retina.c</a> file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;<a class="el" href="fsm_8h.html">fsm.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aed8e6db6e671d630b2664efc84fc5206"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina_8h.html#aed8e6db6e671d630b2664efc84fc5206">fsm_retina_new</a> (<a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_button, uint32_t button_press_time_ms, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_tx, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_rx, uint8_t rgb_id)</td></tr>
<tr class="memdesc:aed8e6db6e671d630b2664efc84fc5206"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new RETINA FSM.  <a href="fsm__retina_8h.html#aed8e6db6e671d630b2664efc84fc5206">More...</a><br /></td></tr>
<tr class="separator:aed8e6db6e671d630b2664efc84fc5206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a4f2bd74849f1b7c031308b8ebec678"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina_8h.html#a0a4f2bd74849f1b7c031308b8ebec678">fsm_retina_init</a> (<a class="el" href="structfsm__t.html">fsm_t</a> *p_this, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_button, uint32_t button_press_time_ms, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_tx, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_rx, uint8_t rgb_id)</td></tr>
<tr class="memdesc:a0a4f2bd74849f1b7c031308b8ebec678"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the infrared transmitter FSM.  <a href="fsm__retina_8h.html#a0a4f2bd74849f1b7c031308b8ebec678">More...</a><br /></td></tr>
<tr class="separator:a0a4f2bd74849f1b7c031308b8ebec678"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header for <a class="el" href="fsm__retina_8c.html" title="Retina FSM main file.">fsm_retina.c</a> file. </p>
<dl class="section author"><dt>Author</dt><dd>Sistemas Digitales II </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2023-01-01 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0a4f2bd74849f1b7c031308b8ebec678"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a4f2bd74849f1b7c031308b8ebec678">&#9670;&nbsp;</a></span>fsm_retina_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fsm_retina_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_this</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_button</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>button_press_time_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the infrared transmitter FSM. </p>
<p>This function initializes the default values of the FSM struct. On the basic version of Retina, it does not have HW (such as status LEDs, as in example); it that case, this function must call to the <code>port</code> to initialize the HW of associated.</p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos Version 2</b></p>
<p>✅ 1. Assign the FSMs with the received values <br  />
✅ 2. Initialize the field <code>long_button_press_ms</code> with value received <br  />
✅ 3. Initialize the field <code>tx_codes_index</code> <br  />
✅ 4. Initialize the array <code>tx_codes_arr</code> with the desired commands for RED, GREEN, and BLUE colors. The remotes at the laboratory are encoded by the company <b>Liluco</b>. Use the macros <a class="el" href="commands_8h.html#a9825879b368bac36801c9bc0ec847a19">LIL_RED_BUTTON</a>, <a class="el" href="commands_8h.html#a6a2668181696b4acff50028ff54b0d5e">LIL_GREEN_BUTTON</a>, and <a class="el" href="commands_8h.html#a6261e02d0201ae32d22efdcb6e8e7b92">LIL_BLUE_BUTTON</a> respectively. </p>
</blockquote>
<p><br  />
</p><blockquote class="doxtable">
<p><b>TO-DO alumnos Version 3</b></p>
<p>✅ 1. Assign the infrared reception FSM with the received value <br  />
✅ 2. Initialize the field <code>working_mode</code> to reception mode <br  />
✅ 3. Initialize the field <code>rx_code</code> to '0x00' </p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code><a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a></code> struct than contains an <code><a class="el" href="structfsm__retina__t.html" title="Structure to define the Retina FSM.">fsm_retina_t</a></code>. </td></tr>
    <tr><td class="paramname">p_fsm_button</td><td>Pointer to an <code><a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a></code> struct than contains an <code><a class="el" href="structfsm__button__t.html" title="Structure to define the Button FSM.">fsm_button_t</a></code>. </td></tr>
    <tr><td class="paramname">button_press_time_ms</td><td>Duration in ms of the button press to change between transmitter and receiver modes </td></tr>
    <tr><td class="paramname">p_fsm_tx</td><td>Pointer to an <code><a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a></code> struct than contains an <code><a class="el" href="structfsm__tx__t.html" title="Structure to define the Infrared transmitter FSM.">fsm_tx_t</a></code>. </td></tr>
    <tr><td class="paramname">p_fsm_rx</td><td>Pointer to an <code><a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a></code> struct than contains an <code><a class="el" href="structfsm__rx__t.html" title="Structure to define the infrared receiver FSM.">fsm_rx_t</a></code>. <b>Added in Version 3.</b> </td></tr>
    <tr><td class="paramname">rgb_id</td><td>Unique RGB identifier number. <b>Added in Version 3.</b> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aed8e6db6e671d630b2664efc84fc5206"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed8e6db6e671d630b2664efc84fc5206">&#9670;&nbsp;</a></span>fsm_retina_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfsm__t.html">fsm_t</a>* fsm_retina_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_button</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>button_press_time_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new RETINA FSM. </p>
<p>This FSM is the main state machine of the Retina system that governs the interaction between the other state machines of the system: button, transmitter and receiver FSM.</p>
<ul>
<li>The FSM starts in the <code>WAIT RX</code> state and checks if the button has been pressed for more than <code>button_press_time_ms</code> ms. If so, it goes to the <code>WAIT TX</code> state to wait to transmit.</li>
<li>When in the <code>WAIT RX</code> state, it checks if the button has been pressed for more than <code>button_press_time_ms</code> ms. If so, it goes to the <code>WAIT RX</code> state to wait to receive.</li>
<li>Being in <code>WAIT RX</code> or <code>WAIT TX</code>, if no machine has any activity (neither the button's FSM, nor the transmitter's, nor the receiver's), it goes to low power mode <code>SLEEP RX</code> or <code>SLEEP TX</code>, respectively.</li>
<li>While in <code>SLEEP RX</code> or <code>SLEEP TX</code>, it checks that no machine has activity, and, by means of an autotransition, it goes to sleep. These autotransitions are used to avoid staying awake by any interruption from other elements than ours, or the debugger.</li>
<li>When waking up by one of our system elements, being in <code>SLEEP RX</code> or <code>SLEEP TX</code>, it will always switch (<code>check_true()</code>) to <code>WAIT RX</code> or <code>WAIT TX</code>, respectively.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_fsm_button</td><td>User button FSM </td></tr>
    <tr><td class="paramname">button_press_time_ms</td><td>Duration in ms of the button press to change between transmitter and receiver modes. </td></tr>
    <tr><td class="paramname">p_fsm_tx</td><td>Infrared transmitter FSM </td></tr>
    <tr><td class="paramname">p_fsm_rx</td><td>Pointer to an <code><a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a></code> struct than contains an <code><a class="el" href="structfsm__rx__t.html" title="Structure to define the infrared receiver FSM.">fsm_rx_t</a></code>. <b>Added in Version 3.</b> </td></tr>
    <tr><td class="paramname">rgb_id</td><td>Unique RGB identifier number. <b>Added in Version 3.</b> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the Retina FSM </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_11fbc4217d50ab21044e5ad6614aede5.html">include</a></li><li class="navelem"><a class="el" href="fsm__retina_8h.html">fsm_retina.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
